{% extends 'SportApp/base.html' %}

{% block content %}
<div class="container mt-4">
    <div class="text-center mb-5">
        <h1 class="display-5 fw-bold text-dark"><i class="bi bi-graph-up-arrow text-primary"></i> Centro de Rendimiento</h1>
        <p class="lead text-muted">Estadísticas de <!-- aqui iria la el el nombre del torneo de las estadisticas-->  </p>
        
        <hr>
        <!-- si somos staff podemos añadir estadísticas -->
        {% if user.is_staff %}
        <a href="{% url 'estadistica_crear' %}" class="btn btn-primary btn-sm mb-3">
            <i class="bi bi-plus-lg"></i> Añadir Estadística de Partido
        </a>
        {% endif %}
    </div>

    <!-- totales con el aggregate-->
    <div class="row text-center mb-5">
        <div class="col-md-3 mb-3">
            <div class="card bg-primary text-white h-100 shadow border-0 py-3">
                <div class="card-body">
                    <h2 class="display-4 fw-bold">{{ globales.total_puntos|default:"0" }}</h2>
                    <p class="text-uppercase small opacity-75">Goles / Puntos Totales</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card bg-success text-white h-100 shadow border-0 py-3">
                <div class="card-body">
                    <h2 class="display-4 fw-bold">{{ globales.total_minutos|default:"0" }}</h2>
                    <p class="text-uppercase small opacity-75">Minutos Jugados</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card bg-info text-white h-100 shadow border-0 py-3">
                <div class="card-body">
                    <h2 class="display-4 fw-bold">{{ globales.partidos_jugados|default:"0" }}</h2>
                    <p class="text-uppercase small opacity-75">Actuaciones de Jugadores</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card bg-warning text-dark h-100 shadow border-0 py-3">
                <div class="card-body">
                    <h2 class="display-4 fw-bold">{{ globales.promedio_puntos|floatformat:1 }}</h2>
                    <p class="text-uppercase small opacity-75">Promedio Puntos/Jugador</p>
                </div>
            </div>
        </div>
    </div>

    <!-- rankin con el annotate -->
    <div class="row">
        
        <!-- mejores jugadores -->
        <div class="col-md-4 mb-4">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-header bg-white border-bottom-0 pt-3">
                    <h5 class="text-primary fw-bold"><i class="bi bi-trophy-fill"></i> Máximos Anotadores</h5>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light small">
                            <tr>
                                <th>#</th>
                                <th>Jugador</th>
                                <th class="text-center">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for jugador in top_puntos %}
                            <tr>
                                <th scope="row">{{ forloop.counter }}</th>
                                <td>
                                    <span class="fw-bold d-block">{{ jugador.nombre }}</span>
                                    <small class="text-muted">{{ jugador.equipo.nombre }}</small>
                                </td>
                                <td class="text-center fw-bold fs-5 text-primary">{{ jugador.total_puntos }}</td>
                            </tr>
                            {% empty %}
                            <tr><td colspan="3" class="text-center text-muted py-3">Sin datos registrados</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- minutos -->
        <div class="col-md-4 mb-4">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-header bg-white border-bottom-0 pt-3">
                    <h5 class="text-success fw-bold"><i class="bi bi-stopwatch-fill"></i> Más Minutos</h5>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light small">
                            <tr>
                                <th>#</th>
                                <th>Jugador</th>
                                <th class="text-center">Minutos</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for jugador in top_minutos %}
                            <tr>
                                <th scope="row">{{ forloop.counter }}</th>
                                <td>{{ jugador.nombre }}</td>
                                <td class="text-center fw-bold">{{ jugador.total_minutos }}'</td>
                            </tr>
                            {% empty %}
                            <tr><td colspan="3" class="text-center text-muted py-3">Sin datos registrados</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- participaciones -->
        <div class="col-md-4 mb-4">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-header bg-white border-bottom-0 pt-3">
                    <h5 class="text-info fw-bold"><i class="bi bi-calendar-check-fill"></i> Más Partidos</h5>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light small">
                            <tr>
                                <th>#</th>
                                <th>Jugador</th>
                                <th class="text-center">Jugados</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for jugador in top_participaciones %}
                            <tr>
                                <th scope="row">{{ forloop.counter }}</th>
                                <td>{{ jugador.nombre }}</td>
                                <td class="text-center fw-bold">{{ jugador.partidos_jugados }}</td>
                            </tr>
                            {% empty %}
                            <tr><td colspan="3" class="text-center text-muted py-3">Sin datos registrados</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
</div>
{% endblock %}